<div class="header-container neu-container">
  <div class="header-content">
    <button class="neu-button menu-btn" (click)="toggleGlobalMenu()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
      <span class="menu-text">Menu</span>
    </button>

    <div class="header-text">
      <h1>{{ currentRouteTitle }}</h1>
    </div>

    <div class="header-actions">
      <!-- Seletor de Idioma -->
      <div class="language-selector neu-input">
        <select class="language-select" [(ngModel)]="selectedLanguage" (change)="changeLanguage($event)">
          <option *ngFor="let lang of languages" [value]="lang.code">
            {{ lang.name }}
          </option>
        </select>
        <div class="selected-flag">
          <img [src]="getSelectedFlag()" [alt]="selectedLanguage" class="flag-icon">
        </div>
      </div>

      <!-- Ícone de Mensagens -->
      <div class="dropdown-container">
        <div class="icon-wrapper neu-button" [class.active]="showMessages" (click)="toggleDropdown('messages')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
          </svg>
          <div class="notification-badge" *ngIf="getUnreadMessagesCount() > 0">
            {{ getUnreadMessagesCount() > 99 ? '99+' : getUnreadMessagesCount() }}
          </div>
        </div>

        <!-- Dropdown de Mensagens -->
        @if (showMessages) {
        <div class="dropdown-panel neu-container">
          <div class="dropdown-header">
            <h3 class="dropdown-title">{{ 'MESSAGES.TITLE' | translate }}</h3>
            <span class="dropdown-count">{{ messages.length }}</span>
          </div>

          <div class="dropdown-content">
            <div class="dropdown-list">
              <!-- No dropdown de Mensagens -->
              @for (message of messages; track message.id) {
              <div class="dropdown-item" [class.unread]="true">
                <div class="item-avatar">
                  <div class="avatar-placeholder">M</div>
                </div>
                <div class="item-content">
                  <div class="item-header">
                    <strong class="item-sender">{{ message.title }}</strong>
                    <span class="item-time">{{ formatTime(message.created) }}</span>
                  </div>
                  <p class="item-preview">{{ message.content }}</p>
                </div>
              </div>
              }
              @if (messages.length === 0) {
              <div class="dropdown-empty">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                </svg>
                <p>{{ 'MESSAGES.EMPTY' | translate }}</p>
              </div>
              }
            </div>
          </div>

          <div class="dropdown-footer">
            <button class="neu-button small full-width" (click)="openAllMessages()">
              {{ 'MESSAGES.VIEW_ALL' | translate }}
            </button>
          </div>
        </div>
        }
      </div>

      <!-- Ícone de Notificações -->
      <div class="dropdown-container">
        <div class="icon-wrapper neu-button" [class.active]="showNotifications"
          (click)="toggleDropdown('notifications')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
            <path d="M13.73 21a2 2 0 0 1-3.46 0" />
          </svg>
          <div class="notification-badge" *ngIf="getUnreadNotificationsCount() > 0">
            {{ getUnreadNotificationsCount() > 99 ? '99+' : getUnreadNotificationsCount() }}
          </div>
        </div>

        <!-- Dropdown de Notificações -->
        @if (showNotifications) {
        <div class="dropdown-panel neu-container">
          <div class="dropdown-header">
            <h3 class="dropdown-title">{{ 'NOTIFICATIONS.TITLE' | translate }}</h3>
            <span class="dropdown-count">{{ notifications.length }}</span>
          </div>

          <div class="dropdown-content">
            <div class="dropdown-list">
              <!-- No dropdown de Notificações -->
              @for (notification of notifications; track notification.id) {
              <div class="dropdown-item" [class.unread]="!notification.isRead">
                <div class="item-icon">
                  <div class="icon-circle" [class]="getNotificationType(notification.iconType)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                      <polyline points="22 4 12 14.01 9 11.01" />
                    </svg>
                  </div>
                </div>
                <div class="item-content">
                  <div class="item-header">
                    <strong class="item-title">{{ notification.title }}</strong>
                    <span class="item-time">{{ formatTime(notification.created) }}</span>
                  </div>
                  <p class="item-message">{{ notification.content }}</p>
                </div>
              </div>
              }
              @if (notifications.length === 0) {
              <div class="dropdown-empty">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                  <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                </svg>
                <p>{{ 'NOTIFICATIONS.EMPTY' | translate }}</p>
              </div>
              }
            </div>
          </div>

          <div class="dropdown-footer">
            <button class="neu-button small full-width" (click)="openAllNotifications()">
              {{ 'NOTIFICATIONS.VIEW_ALL' | translate }}
            </button>
          </div>
        </div>
        }
      </div>
    </div>
  </div>
</div>

<!-- Backdrop para fechar dropdowns ao clicar fora -->
@if (showMessages || showNotifications) {
<div class="dropdown-backdrop" (click)="closeAllDropdowns()"></div>
}